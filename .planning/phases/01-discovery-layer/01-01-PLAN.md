---
phase: 01-discovery-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/main/lib/trpc/routers/index.ts, src/main/lib/trpc/routers/workflows.ts]
autonomous: true
---

<objective>
Create the workflows tRPC router with config directory scanning for agents, commands, and skills.

Purpose: Establish the data pipeline for discovering Claude Code workflow definitions from the filesystem.
Output: Working tRPC router that lists agents, commands, and skills with metadata.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/main/lib/trpc/routers/index.ts
@src/main/lib/trpc/routers/skills.ts
@src/main/lib/trpc/routers/claude-settings.ts
@src/main/lib/db/schema/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create workflows tRPC router</name>
  <files>src/main/lib/trpc/routers/workflows.ts</files>
  <action>
Create a new tRPC router at `src/main/lib/trpc/routers/workflows.ts` with three procedures:

1. **listAgents** - Scan `~/.claude/agents/` (or custom config dir) for .md files
   - Use gray-matter to parse YAML frontmatter
   - Extract: name, description, tools, model
   - Return array with: id (filename), name, description, tools, model, sourcePath

2. **listCommands** - Scan `~/.claude/commands/` for .md files
   - Parse YAML frontmatter with gray-matter
   - Extract: description
   - Return array with: id (filename), name (filename without .md), description, sourcePath

3. **listSkills** - Similar to existing skills router but include frontmatter
   - Scan `~/.claude/skills/*/SKILL.md`
   - Extract: name, description from frontmatter
   - Return array with: id (directory name), name, description, sourcePath

**Security:** Validate directory paths to prevent path traversal. Only allow scanning within the configured Claude config directory.

**Dependencies:** Use existing `gray-matter` package (already in dependencies from skills router).

**Config directory:** Read `customConfigDir` from `claudeCodeSettings` table. If null, use `~/.claude/`.
  </action>
  <verify>
1. File exists at src/main/lib/trpc/routers/workflows.ts
2. TypeScript compiles: bun run ts:check passes
3. Router exports workflowsRouter with listAgents, listCommands, listSkills procedures
  </verify>
  <done>
All three procedures return arrays of items with proper metadata from YAML frontmatter
</done>
</task>

<task type="auto">
  <name>Task 2: Register workflows router in tRPC index</name>
  <files>src/main/lib/trpc/routers/index.ts</files>
  <action>
Import and register the workflows router in the main tRPC router:

1. Import: `import { workflowsRouter } from "./workflows"`
2. Add to appRouter: `workflows: workflowsRouter`

Follow the existing pattern used for other routers (agents, changes, chats, etc.).
  </action>
  <verify>
1. workflowsRouter imported and registered
2. bun run ts:check passes
3. Router available at trpc.workflows in renderer
  </verify>
  <done>
workflows router is accessible via tRPC client
</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `bun run ts:check` passes without errors
- [ ] `bun run build` succeeds
- [ ] Router is properly registered and exported
</verification>

<success_criteria>

- workflows.ts router created with all three procedures
- Each procedure scans appropriate directory and parses YAML frontmatter
- Router registered in main tRPC index
- TypeScript compilation passes
  </success_criteria>

<output>
After completion, create `.planning/phases/01-discovery-layer/01-01-SUMMARY.md`
</output>
